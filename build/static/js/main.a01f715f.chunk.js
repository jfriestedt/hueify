(this.webpackJsonphueify=this.webpackJsonphueify||[]).push([[0],{224:function(e,t,n){"use strict";n.r(t);var r=n(0),a=n.n(r),o=n(18),i=n.n(o),s=n(2),l=n(9),c=n(83),u=n(1),p=Object(l.combineReducers)({tokens:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"REGISTER_TOKENS":return Object(u.assign)({},e,Object(u.pick)(t,"refreshToken"));default:return e}},spotifyPlayerMountStatus:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"NOT_READY",t=arguments.length>1?arguments[1]:void 0,n=t.type;switch(n){case"SPOTIFY_PLAYER_MOUNT_READY":case"SPOTIFY_PLAYER_MOUNTED":return n;default:return e}},spotifyPlayerState:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1?arguments[1]:void 0,n=t.type,r=t.state;switch(n){case"SPOTIFY_PLAYER_STATE_CHANGED":return r;default:return e}},hueBridgeIps:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1?arguments[1]:void 0,n=t.type,r=t.payload;switch(n){case"HUE_BRIDGES_DISCOVERED":return r;default:return e}},palette:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1?arguments[1]:void 0,n=t.type,r=t.payload;switch(n){case"NEW_PALETTE":return r;default:return e}}}),h=n(84);var d=n(10),f=n(11),m=n(13),y=n(12),v=n(14),g=n(85),E=n.n(g),b=(n(35),Object(s.b)((function(e){var t=e.spotifyPlayerState,n=Object(u.chain)(t).get(["track_window","current_track","album","images"]).find({height:300}).value();return{albumArtUrl:n?n.url:""}}))((function(e){var t=e.albumArtUrl;return t?a.a.createElement("img",{alt:"album art",src:t,height:"300",width:"300",decoding:"sync",style:{height:"300px",width:"300px"}}):null}))),O=n(86),k=function(e){function t(){var e;return Object(d.a)(this,t),(e=Object(m.a)(this,Object(y.a)(t).call(this))).swatchStyle={display:"inline-block",width:"50px",height:"50px",fontSize:"6px"},e}return Object(v.a)(t,e),Object(f.a)(t,[{key:"getPaletteId",value:function(e){return Object(u.keys)(e).map((function(t){return e[t].getHex()})).sort().join("_")}},{key:"shouldComponentUpdate",value:function(e){var t=e.albumArtUrl,n=e.palette;return t!==this.props.albumArtUrl||this.getPaletteId(n)!==this.getPaletteId(this.props.palette)}},{key:"componentDidUpdate",value:function(e){var t=this;e.albumArtUrl!==this.props.albumArtUrl&&new O(this.props.albumArtUrl,{filters:[]}).getPalette((function(e,n){t.props.dispatch({type:"NEW_PALETTE",payload:n})}))}},{key:"renderSwatch",value:function(e){var t=this.props.palette[e].getHex(),n=Object(u.assign)({},this.swatchStyle,{backgroundColor:t});return a.a.createElement("div",{key:e,style:n},e)}},{key:"render",value:function(){var e=this;if(this.props.palette){var t=Object(u.keys)(this.props.palette).map((function(t){return e.renderSwatch(t)}));return a.a.createElement("div",{id:"palette",style:{marginBottom:"20px"}},t)}return null}}]),t}(r.Component),_=Object(s.b)((function(e){var t=e.spotifyPlayerState,n=e.palette,r=Object(u.chain)(t).get(["track_window","current_track","album","images"]).find({height:64}).value();return{albumArtUrl:r?r.url:"",palette:n}}))(k),j=Object(s.b)((function(e){return{loggedIn:!!e.tokens.refreshToken}}))((function(e){return e.loggedIn?null:a.a.createElement("a",{className:"button",href:"/login"},"Log in to Spotify")})),S=n(87),P=n(226),w=function(e){function t(){var e;return Object(d.a)(this,t),(e=Object(m.a)(this,Object(y.a)(t).call(this))).state={mounting:!1,error:null},window.onSpotifyWebPlaybackSDKReady=function(){e.props.dispatch({type:"SPOTIFY_PLAYER_MOUNT_READY"})},e}return Object(v.a)(t,e),Object(f.a)(t,[{key:"mountPlayer",value:function(){var e=this;this.setState({mounting:!0});var t=new window.Spotify.Player({name:"_*_HUEIFY_*_",getOAuthToken:function(t){var n="/refresh_token?refresh_token=".concat(e.props.refreshToken);fetch(n).then((function(e){return e.json()})).then((function(e){var n=e.access_token;return t(n)}))}});t.addListener("initialization_error",(function(t){var n=t.message;e.setState({error:n}),console.error(n)})),t.addListener("authentication_error",(function(t){var n=t.message;e.setState({error:n}),console.error(n)})),t.addListener("account_error",(function(t){var n=t.message;e.setState({error:n}),console.error(n)})),t.addListener("playback_error",(function(t){var n=t.message;e.setState({error:n}),console.error(n)})),t.addListener("player_state_changed",(function(t){e.props.dispatch({type:"SPOTIFY_PLAYER_STATE_CHANGED",state:t})})),console.log("player exists: "+!!t),console.log("adding ready listener"),t.addListener("ready",(function(t){var n=t.device_id;console.log("Ready with Device ID",n),e.props.dispatch({type:"SPOTIFY_PLAYER_MOUNTED"}),e.setState({mounting:!1})})),t.addListener("not_ready",(function(e){var t=e.device_id;console.log("Device ID has gone offline",t)})),t.connect()}},{key:"componentDidMount",value:function(){var e,t=new URLSearchParams(window.location.search).get("refresh_token");t&&this.props.dispatch((e={refreshToken:t},Object(u.assign)(e,{type:"REGISTER_TOKENS"})))}},{key:"componentDidUpdate",value:function(e,t){this.props.refreshToken&&this.props.spotifyPlayerMountReady&&!this.state.mounting&&(console.log("mounting player"),this.mountPlayer())}},{key:"renderDeviceInfoLoading",value:function(){if(this.state.error)return a.a.createElement("h4",{className:"error"},this.state.error);var e=this.props.refreshToken&&this.props.spotifyPlayerMountReady&&!this.props.spotifyPlayerMounted;return a.a.createElement(P.a,{in:e,exit:!1,timeout:200,classNames:"device-info",unmountOnExit:!0},a.a.createElement("div",null,a.a.createElement("h4",null,"Connecting to Spotify"),a.a.createElement("h6",null,"This could take a minute...")))}},{key:"renderConnectPrompt",value:function(){return Object(u.isEmpty)(this.props.spotifyPlayerState)?a.a.createElement("div",null,a.a.createElement("h4",null,"Connect to device:"),a.a.createElement("h4",null,a.a.createElement("strong",null,"_*_HUEIFY_*_"))):null}},{key:"renderDeviceInfo",value:function(){return a.a.createElement(P.a,{in:this.props.spotifyPlayerMounted,timeout:200,classNames:"device-info",unmountOnExit:!0},a.a.createElement("div",null,this.renderConnectPrompt()))}},{key:"render",value:function(){return a.a.createElement("div",null,a.a.createElement(S.Helmet,null,a.a.createElement("script",{src:"https://sdk.scdn.co/spotify-player.js"})),this.renderDeviceInfoLoading(),this.renderDeviceInfo())}}]),t}(r.Component),T=Object(s.b)((function(e){var t=e.tokens.refreshToken,n=e.spotifyPlayerMountStatus;return{refreshToken:t,spotifyPlayerState:e.spotifyPlayerState,spotifyPlayerMountReady:"SPOTIFY_PLAYER_MOUNT_READY"===n,spotifyPlayerMounted:"SPOTIFY_PLAYER_MOUNTED"===n}}))(w),I=function(e){function t(){return Object(d.a)(this,t),Object(m.a)(this,Object(y.a)(t).apply(this,arguments))}return Object(v.a)(t,e),Object(f.a)(t,[{key:"componentDidMount",value:function(){var e=this;return fetch("https://discovery.meethue.com/").then((function(e){return e.json()})).then((function(t){e.props.dispatch({type:"HUE_BRIDGES_DISCOVERED",payload:t.map((function(e){return e.internalipaddress}))})}))}},{key:"componentDidUpdate",value:function(e){Object(u.isEmpty)(e.bridgeIps)&&Object(u.isEmpty)(this.props.bridgeIps)}},{key:"render",value:function(){return Object(u.isEmpty)(this.props.hueBridgeIps)?null:a.a.createElement("ul",{style:{margin:"20px",position:"absolute"}},a.a.createElement("h6",null,"Philips Hue IPs:"),this.props.hueBridgeIps.map((function(e){return a.a.createElement("li",{key:e},e)})))}}]),t}(r.Component),D=Object(s.b)((function(e){return{hueBridgeIps:e.hueBridgeIps}}))(I),A=Object(s.b)((function(e){var t=e.spotifyPlayerState,n=Object(u.get)(t,["track_window","current_track"]);return{title:Object(u.get)(n,"name"),artist:Object(u.get)(n,["artists",0,"name"])}}))((function(e){var t=e.title,n=e.artist;return t&&n?a.a.createElement("div",{id:"track-info",style:{width:"300px"}},a.a.createElement("h4",null,t),a.a.createElement("h5",null,n)):null})),R=function(e){function t(){var e;Object(d.a)(this,t),e=Object(m.a)(this,Object(y.a)(t).call(this));var n=E.a.parse(window.navigator.userAgent);return e.isBrowserSupported="desktop"===Object(u.get)(n,["platform","type"]),e.mainStyleBase={display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",width:"100%",height:"100%",position:"absolute",transition:"background-color 0.5s ease, color 0.5s ease"},e}return Object(v.a)(t,e),Object(f.a)(t,[{key:"render",value:function(){var e=Object(u.assign)({},this.mainStyleBase,{backgroundColor:this.props.darkHex,color:this.props.lightHex});return this.isBrowserSupported?a.a.createElement("div",{className:"App"},a.a.createElement(D,null),a.a.createElement("div",{style:e},a.a.createElement(j,null),a.a.createElement(b,null),a.a.createElement(_,null),a.a.createElement(A,null),a.a.createElement(T,null))):a.a.createElement("div",{className:"App"},a.a.createElement("div",{style:this.mainStyle},a.a.createElement("h4",{className:"error"},"Sorry homie, Hueify only works on Desktop browsers. :'(")))}}]),t}(r.Component),x=Object(s.b)((function(e){var t=e.palette;return{lightHex:Object(u.isEmpty)(t)?null:t.LightVibrant.getHex(),darkHex:Object(u.isEmpty)(t)?null:t.DarkVibrant.getHex()}}))(R);Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));i.a.render(a.a.createElement(s.a,{store:function(){return arguments.length>0&&void 0!==arguments[0]&&arguments[0],Object(l.createStore)(p,Object(h.composeWithDevTools)(Object(l.applyMiddleware)(c.a)))}()},a.a.createElement(x,null)),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()}))},35:function(e,t,n){},89:function(e,t,n){e.exports=n(224)}},[[89,1,2]]]);
//# sourceMappingURL=main.a01f715f.chunk.js.map